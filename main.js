!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var n;i.r(e);var s=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(s)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var r=function(t){return"string"==typeof t&&a.test(t)},h=[],l=0;l<256;++l)h.push((l+256).toString(16).substr(1));var c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!r(i))throw TypeError("Stringified UUID is invalid");return i};var d=function(t,e,i){var n=(t=t||{}).random||(t.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){i=i||0;for(var s=0;s<16;++s)e[i+s]=n[s];return e}return c(n)};class m{constructor(t,e,i){this.button=document.createElement("input"),this.button.type="checkbox",this.button.name=t,this.button.id=t,this.button.hidden="",i&&this.button.classList.add(i),this.buttonLabel=document.createElement("label"),this.buttonLabel.for=t,this.buttonLabel.id=`${t}-label`,this.buttonLabel.innerHTML=`<span>${e}</span>`,this.buttonLabel.insertAdjacentElement("afterbegin",this.button)}add(t){t.insertAdjacentElement("beforeend",this.buttonLabel)}}let u={};const p=new WeakMap,f={metric:[{from:0,to:1e3,unit:"B",long:"bytes"},{from:1e3,to:1e6,unit:"kB",long:"kilobytes"},{from:1e6,to:1e9,unit:"MB",long:"megabytes"},{from:1e9,to:1e12,unit:"GB",long:"gigabytes"},{from:1e12,to:1e15,unit:"TB",long:"terabytes"},{from:1e15,to:1e18,unit:"PB",long:"petabytes"},{from:1e18,to:1e21,unit:"EB",long:"exabytes"},{from:1e21,to:1e24,unit:"ZB",long:"zettabytes"},{from:1e24,to:1e27,unit:"YB",long:"yottabytes"}],metric_octet:[{from:0,to:1e3,unit:"o",long:"octets"},{from:1e3,to:1e6,unit:"ko",long:"kilooctets"},{from:1e6,to:1e9,unit:"Mo",long:"megaoctets"},{from:1e9,to:1e12,unit:"Go",long:"gigaoctets"},{from:1e12,to:1e15,unit:"To",long:"teraoctets"},{from:1e15,to:1e18,unit:"Po",long:"petaoctets"},{from:1e18,to:1e21,unit:"Eo",long:"exaoctets"},{from:1e21,to:1e24,unit:"Zo",long:"zettaoctets"},{from:1e24,to:1e27,unit:"Yo",long:"yottaoctets"}],iec:[{from:0,to:Math.pow(1024,1),unit:"B",long:"bytes"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"KiB",long:"kibibytes"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"MiB",long:"mebibytes"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"GiB",long:"gibibytes"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"TiB",long:"tebibytes"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"PiB",long:"pebibytes"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"EiB",long:"exbibytes"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"ZiB",long:"zebibytes"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"YiB",long:"yobibytes"}],iec_octet:[{from:0,to:Math.pow(1024,1),unit:"o",long:"octets"},{from:Math.pow(1024,1),to:Math.pow(1024,2),unit:"Kio",long:"kibioctets"},{from:Math.pow(1024,2),to:Math.pow(1024,3),unit:"Mio",long:"mebioctets"},{from:Math.pow(1024,3),to:Math.pow(1024,4),unit:"Gio",long:"gibioctets"},{from:Math.pow(1024,4),to:Math.pow(1024,5),unit:"Tio",long:"tebioctets"},{from:Math.pow(1024,5),to:Math.pow(1024,6),unit:"Pio",long:"pebioctets"},{from:Math.pow(1024,6),to:Math.pow(1024,7),unit:"Eio",long:"exbioctets"},{from:Math.pow(1024,7),to:Math.pow(1024,8),unit:"Zio",long:"zebioctets"},{from:Math.pow(1024,8),to:Math.pow(1024,9),unit:"Yio",long:"yobioctets"}]};class g{constructor(t,e){e=Object.assign({units:"metric",precision:1,locale:void 0},u,e),p.set(this,e),Object.assign(f,e.customUnits);const i=t<0?"-":"";t=Math.abs(t);const n=f[e.units];if(!n)throw new Error(`Invalid units specified: ${e.units}`);{const s=n.find((e=>t>=e.from&&t<e.to));if(s){const n=new Intl.NumberFormat(e.locale,{style:"decimal",minimumFractionDigits:e.precision,maximumFractionDigits:e.precision}),o=0===s.from?i+t:i+n.format(t/s.from);this.value=o,this.unit=s.unit,this.long=s.long}else this.value=i+t,this.unit="",this.long=""}}toString(){const t=p.get(this);return t.toStringFn?t.toStringFn.bind(this)():`${this.value} ${this.unit}`}}function v(t,e){return new g(t,e)}v.defaultOptions=function(t){u=t};var b=v;class w{constructor(){this.audio=["wav","mp3","flac","wma","aac"],this.video=["mp4","mpeg","mov","wmv","flv","avi","mkv"],this.image=["png","jpg","jpeg","gif"]}check(t){const e=t.split(".").pop();return this.audio.indexOf(e)>=0?"audio":this.video.indexOf(e)>=0?"video":this.image.indexOf(e)>=0?"img":"other"}}class E{constructor(t){this.fileType=(new w).check(t.name),this.reader=new FileReader,this.elem=document.createElement("div"),this.elem.id="preview-container",this.elem.innerHTML=`<span>${/(.*)\.{1}[a-zA-Z0-9]*$/gm.exec(t.name)[1]} ${t.type}</span>`,this.reader.onload=e=>{const i=e.target.result,n=new Blob([new Uint8Array(i)],{type:t.type}),s=window.URL.createObjectURL(n);"other"!==this.fileType?(this.preview=document.createElement(this.fileType),this.preview.className="preview",this.preview.src=s,"img"!==this.fileType&&(this.preview.controls=!0)):(this.preview=document.createElement("div"),this.preview.innerHTML="ðŸ“„",this.preview.className="no-preview"),"video"===this.fileType&&this.preview.load(),this.elem.append(this.preview)},this.reader.readAsArrayBuffer(t)}}const y="https://ahj-diploma.herokuapp.com/";class x{constructor(t=null,e=null,i){t?(this.file=t,this.url=t.path.replace("public/",""),this.size=`${b(t.size)}`,this.name=t.name,this.type=(new w).check(this.name)):(this.url=e.url.replace("public/",""),this.size=e.size,this.name=e.name,this.type=e.type),this.ui=i}addElem(t,e=!1){this.attatchmentElem=document.createElement("li"),this.attatchmentElem.className="attatchment",this.attatchmentElem.innerHTML=`<span class = "attatchment-name">${this.name}</span> \n    <span class = "attatchment-size">(${this.size})</span>`,this.attatchmentElem.dataset.url=this.url,this.attatchmentElem.dataset.size=this.size,this.attatchmentElem.dataset.name=this.name,this.attatchmentElem.dataset.type=this.type,t.append(this.attatchmentElem),e&&(this.removeAttatchment=document.createElement("span"),this.removeAttatchment.className="remove-attatchment",this.removeAttatchment.innerText="âœ–",this.attatchmentElem.insertAdjacentElement("beforeend",this.removeAttatchment),this.removeAttatchment.addEventListener("click",(()=>{fetch(`${y}${this.url}`,{method:"DELETE"}).then((()=>{this.attatchmentElem.remove(),this.removeAttatchment.remove()})).catch((t=>{throw new Error(t)}))}))),this.attatchmentElem.querySelector(".attatchment-name").addEventListener("click",(()=>{this.ui.openModal(),this.ui.openWaitMode(),this.closePreview=document.createElement("span"),this.closePreview.id="close-preview-button",this.closePreview.innerText="âœ–",this.closePreview.addEventListener("click",(t=>{t.preventDefault(),this.ui.closeModal()})),fetch(`${y}${this.url}`).then((t=>{t.blob().then((t=>{this.ui.closeWaitMode();const e=new File([t],this.name),i=new E(e).elem;this.ui.modalWindow.insertAdjacentElement("beforeend",this.closePreview),this.ui.modalWindow.append(i);const n=window.URL.createObjectURL(t),s=document.createElement("a");s.className="download",s.href=n,s.download=`${this.url}`,s.innerText=`Download (${this.size})`,this.ui.modalWindow.insertAdjacentElement("beforeend",s)}))}))}))}}var L=/((https?|ftp):\/\/)+[\w/\-?=%.]+\.[\w/\-&?=%.]+/gm;class M{constructor(t,e){this.id=t.id||d(),this.location=t.location||null,this.text=t.text,this.created=t.created||(new Date).toISOString(),this.tags=t.tags||this.getTags(this.text),this.attatchments=t.attatchments||[],this.fav=t.fav||!1,this.ui=e}getTags(t){this.regex=/#[a-zA-Z0-9]*/gm;const e=[];let i;for(;null!==(i=this.regex.exec(t));)i.index===this.regex.lastIndex&&(this.regex.lastIndex+=1),i.forEach((t=>{e.push(t.replace("#",""))}));return e}buildElement(){this.note=document.createElement("div"),this.note.className="note",this.note.id=`${this.id}`;let t="Location unknown";if(this.location&&(t=`[${this.location.latitude}, ${this.location.longitude}]`),this.noteInfo=document.createElement("div"),this.noteInfo.className="note-info",this.noteInfo.innerHTML=`<span class = 'created'> ${new Date(this.created).toLocaleString("en-GB")} </span>\n    <span class = 'location'> ${t}</span>`,this.favbutton=new m("note-fav","â­","note-fav"),this.favbutton.button.checked=this.fav,this.favbutton.add(this.noteInfo),this.favbutton.button.addEventListener("change",(t=>{t.preventDefault(),fetch(`https://ahj-diploma.herokuapp.com/${this.id}`,{method:"PUT"})})),this.note.insertAdjacentElement("beforeend",this.noteInfo),this.noteText=document.createElement("div"),this.noteText.className="note-text",this.noteText.innerHTML=this.text.replace(L,'<a href = "$&" target=_blank>$&</a>'),this.note.insertAdjacentElement("beforeend",this.noteText),this.attatchments.length){const t=document.createElement("ul");t.className="attatchments",this.attatchments.forEach((e=>{new x(null,e,this.ui).addElem(t,!1)})),this.note.insertAdjacentElement("beforeend",t)}this.tags.length&&this.tags.forEach((t=>{const e=document.createElement("span");e.className="message-tag",e.innerText=`${t}`,this.note.insertAdjacentElement("beforeend",e)}))}hide(){this.note.className="note-hidden"}show(){this.note.className="note"}draw(t){let e="beforeend";t&&(e="afterbegin"),document.getElementById("messages").insertAdjacentElement(e,this.note)}}class T{constructor(){this.state=!1,this.fav=!1,this.audio=!1,this.video=!1,this.image=!1,this.other=!1,this.tags=[],this.text=null}filter(t){t.forEach((t=>{let e=!1;(()=>{if((!this.fav||t.fav)&&(!this.audio||t.attatchments.filter((t=>"audio"===t.type)).length)&&(!this.image||t.attatchments.filter((t=>"img"===t.type)).length)&&(!this.video||t.attatchments.filter((t=>"video"===t.type)).length)&&(!this.other||t.attatchments.filter((t=>"other"===t.type)).length)&&(!this.tags.length||!this.tags.filter((e=>!t.tags.includes(e))).length)){if(this.text){if(t.text.indexOf(this.text)<0)return;const e=t.note.querySelector(".note-text");e.innerHTML=e.innerHTML.replace(this.text,`<span class="text-match">${this.text}</span>`)}e=!0}})(),e?t.show():t.hide()}))}}class F{drawUI(){this.container=document.createElement("div"),this.container.id="container",this.sidePanel=document.createElement("form"),this.sidePanel.id="side-panel",this.search=document.createElement("input"),this.search.name="search",this.search.id="search",this.search.placeholder="Search..",this.sidePanel.insertAdjacentElement("afterbegin",this.search),this.isFav=new m("fav","â­Favorited","fav"),this.isFav.add(this.sidePanel),this.contains=document.createElement("div"),this.contains.id="contains",this.containsAudio=new m("image","ðŸ–¼ï¸","contains"),this.containsAudio.add(this.contains),this.containsAudio=new m("audio","ðŸŽ§","contains"),this.containsAudio.add(this.contains),this.containsVideo=new m("video","ðŸ“¹","contains"),this.containsVideo.add(this.contains),this.containsOther=new m("other","ðŸ“‹","contains"),this.containsOther.add(this.contains),this.sidePanel.insertAdjacentElement("beforeend",this.contains),this.tags=document.createElement("div"),this.tags.id="tags",this.sidePanel.insertAdjacentElement("beforeend",this.tags),this.searchClear=document.createElement("button"),this.searchClear.id="search-clear",this.searchClear.innerText="Clear",this.sidePanel.insertAdjacentElement("beforeend",this.searchClear),this.messageForm=document.createElement("form"),this.messageForm.id="message-form",this.messages=document.createElement("div"),this.messages.id="messages",this.messageText=document.createElement("textarea"),this.messageText.required=!0,this.messageText.name="message-text",this.messageText.id="message-text",this.messageControls=document.createElement("div"),this.messageControls.id="message-controls",this.addFile=document.createElement("button"),this.addFile.innerText="ðŸ“Ž Add file",this.addFile.id="add-file",this.messageControls.insertAdjacentElement("afterbegin",this.addFile),this.markFavorite=new m("mark-favorite","â­ Mark","message-control"),this.markFavorite.add(this.messageControls),this.addLocation=new m("add-location","ðŸ“ Add location","message-control"),this.addLocation.add(this.messageControls),this.messageClear=document.createElement("button"),this.messageClear.innerText="Clear",this.messageClear.id="clear",this.messageControls.insertAdjacentElement("beforeend",this.messageClear),this.messageSend=document.createElement("button"),this.messageSend.innerText="Send",this.messageSend.id="send",this.messageControls.insertAdjacentElement("beforeend",this.messageSend),this.messageAttatchments=document.createElement("div"),this.messageAttatchments.id="message-attatchments",this.messageForm.append(this.messageText,this.messageAttatchments,this.messageControls),this.mainPanel=document.createElement("main"),this.mainPanel.id="main-panel",this.mainPanel.append(this.messages,this.messageForm),this.container.append(this.mainPanel,this.sidePanel),document.body.appendChild(this.container),this.messagesHeight=this.messages.offsetHeight}openModal(){this.modalContainer=document.createElement("div"),this.modalContainer.id="modal-container",this.modalWindow=document.createElement("div"),this.modalWindow.id="modal-window",document.body.append(this.modalContainer),this.modalContainer.append(this.modalWindow)}openLocationForm(){this.openModal(),this.locationForm=document.createElement("form"),this.locationForm.id="location-form",this.locationForm.name="location-form",this.location=document.createElement("input"),this.location.id="location",this.location.name="location",this.location.required=!0,this.saveLocation=document.createElement("button"),this.saveLocation.id="save-location-button",this.saveLocation.innerText="Save",this.cancelLocation=document.createElement("button"),this.cancelLocation.id="cancel-location-button",this.cancelLocation.innerText="Cancel",this.modalWindow.append(this.locationForm),this.locationForm.append(this.location,this.saveLocation,this.cancelLocation)}closeModal(){this.modalContainer.remove()}openWaitMode(){this.topLayer=document.createElement("div"),this.topLayer.id="please-wait",document.body.append(this.topLayer),this.topLayer.innerText="Loading..."}closeWaitMode(){this.topLayer.remove()}openFilesForm(){this.openModal(),this.upload=document.createElement("form"),this.upload.id="upload",this.uploadOverlay=document.createElement("div"),this.uploadOverlay.id="upload-overlay",this.uploadInput=document.createElement("input"),this.uploadInput.id="upload-input",this.uploadInput.type="file",this.uploadInput.multiple=!1,this.uploadInput.required=!0,this.cancelUpload=document.createElement("span"),this.cancelUpload.id="cancel-upload",this.cancelUpload.innerText="âœ–",this.confirmUpload=document.createElement("button"),this.confirmUpload.id="confirm-upload-button",this.confirmUpload.innerText="Upload",this.modalWindow.append(this.cancelUpload),this.upload.append(this.uploadOverlay,this.uploadInput),this.modalWindow.append(this.upload)}addTag(t){new m(`tag-${t}`,t,"tag").add(this.tags)}}class A{validate(t){this.regex=/\[?(-?[0-9]+\.[0-9]+)\s?,\s?(-?[0-9]+\.[0-9]+)\]?/gm;const e=this.regex.exec(t);if(!e)throw new Error("ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚.");const i=e[1],n=e[2];if(parseFloat(i.replace("-",""))>90||parseFloat(n.replace("-",""))>180)throw new Error("ÐšÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹.");return{latitude:i,longitude:n}}}const k=new class{constructor(){this.request={},this.filter=new T,this.ui=new F,this.ui.drawUI(),this.notes=[],this.tags=new Set,this.validator=new A,this.typeChecker=new w,this.data={},this.manualCoords=!1}loadNoteOnScroll(){this.ui.messages.getBoundingClientRect().bottom>this.ui.messages.clientHeight+100||this.requireNextNote()}requireNextNote(t=null){const e={type:"getnext"};t&&(e.startfrom=t),this.checkMessagesContainer()&&this.ws.send(JSON.stringify(e))}checkMessagesContainer(){const t=Array.from(document.getElementsByClassName("note")).slice(-1)[0];return!t||t.getBoundingClientRect().bottom<this.ui.messages.getBoundingClientRect().bottom}connect(){this.ws=new WebSocket("wss://ahj-diploma.herokuapp.com/ws"),this.ws.addEventListener("open",(()=>{this.requireNextNote()})),this.ws.addEventListener("message",(t=>{const e=JSON.parse(t.data);if(e.value){const t=new M(JSON.parse(e.value),this.ui);if(this.notes.indexOf(t)<0){t.buildElement(),this.filter.filter([t]),t.draw(e.new||!1),this.notes.push(t),t.tags.forEach((t=>{this.tags.has(t)||(this.ui.addTag(t),this.tags.add(t),document.getElementById(`tag-${t}`).addEventListener("change",(()=>{const e=this.filter.tags.indexOf(t);e>=0?this.filter.tags.splice(e,1):this.filter.tags.push(t),this.filter.filter(this.notes)})))}));const i=new Event("change");Array.from(t.note.querySelectorAll(".message-tag")).forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const e=document.getElementById(`tag-${t.target.innerText}`);e.dispatchEvent(i),e.checked=!e.checked}))})),t.favbutton.button.addEventListener("change",(()=>{t.fav=t.favbutton.button.checked,this.filter.filter([t])}))}}e.done?e.done&&(this.ui.messages.onscroll=null):(this.requireNextNote(),this.ui.messages.onscroll||(this.ui.messages.onscroll=this.loadNoteOnScroll.bind(this)))})),this.ws.addEventListener("close",(()=>{})),this.ws.addEventListener("error",(t=>{this.showMessage(`${(new Date).toLocaleDateString()} ${(new Date).toLocaleTimeString()}`,"SERVER",t,"")}))}bindLocationForm(){this.ui.locationForm.addEventListener("submit",(t=>{t.preventDefault()})),this.ui.saveLocation.addEventListener("click",(t=>{t.preventDefault();try{this.data.location=this.validator.validate(this.ui.location.value),this.ui.closeModal()}catch(t){"warning"===this.ui.location.nextSibling.className&&this.ui.location.nextSibling.remove(),this.ui.location.insertAdjacentHTML("afterend",`<span class="warning">${t.message}</span>`)}})),this.ui.cancelLocation.addEventListener("click",(t=>{t.preventDefault(),this.ui.closeModal(),this.ui.addLocation.button.checked=!1}))}uploadFile(t){t.preventDefault();const e=t.target.files&&t.target.files[0];if(e){const t=document.getElementById("preview-container");t&&t.remove(),this.ui.modalWindow.insertAdjacentElement("beforeend",new E(e).elem),this.ui.modalWindow.insertAdjacentElement("beforeend",this.ui.confirmUpload),this.ui.confirmUpload.addEventListener("click",(t=>{t.preventDefault();const i=new FormData;i.append("file",e);const n=new XMLHttpRequest;n.addEventListener("loadstart",(()=>{this.ui.openWaitMode()})),n.addEventListener("loadend",(()=>{if(n.status>=200&&n.status<300){this.ui.closeWaitMode();try{const t=JSON.parse(n.response),e=new x(t,null,this.ui);this.ui.closeModal(),this.ui.attatchmentsList||(this.ui.attatchmentsList=document.createElement("ul"),this.ui.attatchmentsList.className="attatchments-list",this.ui.messageForm.appendChild(this.ui.attatchmentsList)),e.addElem(this.ui.attatchmentsList,!0)}catch(t){throw new Error(t)}}})),n.open("POST","https://ahj-diploma.herokuapp.com/",!0),n.send(i)}))}}bindFilesForm(){this.ui.uploadInput.addEventListener("change",this.uploadFile.bind(this)),this.ui.uploadInput.addEventListener("dragdrop",this.uploadFile.bind(this)),this.ui.cancelUpload.addEventListener("click",(t=>{t.preventDefault(),this.ui.upload.reset(),this.ui.closeModal()}))}requestPosition(){return new Promise(((t,e)=>{navigator.geolocation.getCurrentPosition((e=>{t({latitude:e.coords.latitude,longitude:e.coords.longitude})}),(t=>{e(t)}),{timeout:5e3})}))}sendMessage(){this.data.text=this.ui.messageText.value,this.data.fav=this.ui.markFavorite.button.checked,this.data.attatchments=[];Array.from(document.querySelectorAll("#message-form .attatchment")).forEach((t=>{this.data.attatchments.push(t.dataset),t.remove()}));const t=new M(this.data);this.ui.messageForm.reset(),delete this.data.attatchments,delete this.data.text,delete this.manualCoords,delete this.data.location,this.ws.send(JSON.stringify({type:"newnote",content:t}))}bind(){this.ui.sidePanel.addEventListener("submit",(t=>{t.preventDefault()})),this.ui.messages.onscroll=this.loadNoteOnScroll.bind(this),Array.from(this.ui.contains.querySelectorAll('input[type="checkbox"]')).concat(this.ui.isFav.button).forEach((t=>{t.addEventListener("change",(e=>{e.preventDefault(),this.filter[t.id]=!this.filter[t.id],this.filter.filter(this.notes),this.requireNextNote(this.notes.slice(-1)[0].id)}))})),this.ui.search.addEventListener("input",(t=>{t.preventDefault(),this.filter.text=t.target.value,this.notes.forEach((t=>{t.note.querySelector(".note-text").innerText=t.text})),this.filter.filter(this.notes),this.requireNextNote(this.notes.slice(-1)[0].id)})),this.ui.searchClear.addEventListener("click",(t=>{t.preventDefault(),this.filter=new T,this.ui.sidePanel.reset(),this.filter.filter(this.notes),this.requireNextNote(this.notes.slice(-1)[0].id)})),this.ui.messageForm.addEventListener("submit",(t=>{t.preventDefault()})),this.ui.messageClear.addEventListener("click",(t=>{t.preventDefault(),this.ui.messageForm.reset()})),this.ui.addFile.addEventListener("click",(t=>{t.preventDefault(),this.ui.openFilesForm(),this.bindFilesForm()})),this.ui.messageSend.addEventListener("click",(t=>{t.preventDefault(),this.ui.addLocation.button.checked&&!this.data.location?this.manualCoords?(this.ui.openLocationForm(),this.bindLocationForm()):this.requestPosition().then((t=>{this.data.location=t,this.sendMessage()})).catch((t=>{this.ui.openLocationForm(),this.bindLocationForm(),this.manualCoords=!0})):this.sendMessage()}))}};k.bind(),k.connect()}]);